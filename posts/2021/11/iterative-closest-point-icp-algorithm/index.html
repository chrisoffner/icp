<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Chris Offner ">
<meta name="description" content="ICP is used in Simultaneous Localisation and Mapping (SLAM) systems for LiDAR or RGBD data The algorithm is comprised of two steps:  Data association Let \(A, B\) be our point clouds. For each point \(a_i \in A\) we perform a nearest-neighbour search among points \(b_j \in B\) to find the point \(b_j\) with closest distance to \(a_i\). Transformation Align point clouds on top of each other. Compute centres of mass." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://chrisoffner.github.io/studynotes/posts/2021/11/iterative-closest-point-icp-algorithm/" />


    <title>
        
            Iterative Closest Point (ICP) Algorithm :: Chris Offner 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://chrisoffner.github.io/studynotes/main.17863a81d979b637a02cd7632a4d86e9d80563ef460fd6af1a56962efcaa066b.css">



    <link rel="apple-touch-icon" sizes="180x180" href="https://chrisoffner.github.io/studynotes/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://chrisoffner.github.io/studynotes/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://chrisoffner.github.io/studynotes/favicon-16x16.png">
    <link rel="manifest" href="https://chrisoffner.github.io/studynotes/site.webmanifest">
    <link rel="mask-icon" href="https://chrisoffner.github.io/studynotes/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="https://chrisoffner.github.io/studynotes/favicon.ico">
    <meta name="msapplication-TileColor" content="">
    <meta name="theme-color" content="">



<meta itemprop="name" content="Iterative Closest Point (ICP) Algorithm">
<meta itemprop="description" content="ICP is used in Simultaneous Localisation and Mapping (SLAM) systems for LiDAR or RGBD data The algorithm is comprised of two steps:  Data association Let \(A, B\) be our point clouds. For each point \(a_i \in A\) we perform a nearest-neighbour search among points \(b_j \in B\) to find the point \(b_j\) with closest distance to \(a_i\). Transformation Align point clouds on top of each other. Compute centres of mass."><meta itemprop="datePublished" content="2021-11-10T11:48:27+01:00" />
<meta itemprop="dateModified" content="2021-11-10T11:48:27+01:00" />
<meta itemprop="wordCount" content="998"><meta itemprop="image" content="https://chrisoffner.github.io/studynotes/"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://chrisoffner.github.io/studynotes/"/>

<meta name="twitter:title" content="Iterative Closest Point (ICP) Algorithm"/>
<meta name="twitter:description" content="ICP is used in Simultaneous Localisation and Mapping (SLAM) systems for LiDAR or RGBD data The algorithm is comprised of two steps:  Data association Let \(A, B\) be our point clouds. For each point \(a_i \in A\) we perform a nearest-neighbour search among points \(b_j \in B\) to find the point \(b_j\) with closest distance to \(a_i\). Transformation Align point clouds on top of each other. Compute centres of mass."/>




    <meta property="og:title" content="Iterative Closest Point (ICP) Algorithm" />
<meta property="og:description" content="ICP is used in Simultaneous Localisation and Mapping (SLAM) systems for LiDAR or RGBD data The algorithm is comprised of two steps:  Data association Let \(A, B\) be our point clouds. For each point \(a_i \in A\) we perform a nearest-neighbour search among points \(b_j \in B\) to find the point \(b_j\) with closest distance to \(a_i\). Transformation Align point clouds on top of each other. Compute centres of mass." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chrisoffner.github.io/studynotes/posts/2021/11/iterative-closest-point-icp-algorithm/" /><meta property="og:image" content="https://chrisoffner.github.io/studynotes/"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-10T11:48:27+01:00" />
<meta property="article:modified_time" content="2021-11-10T11:48:27+01:00" />







    <meta property="article:published_time" content="2021-11-10 11:48:27 &#43;0100 CET" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://chrisoffner.github.io/studynotes/posts/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark"></span>
            <span class="logo__text">Chris&#39; Study Notes</span>
            <span class="logo__cursor" style=
                  "visibility:hidden;
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://chrisoffner.github.io/studynotes/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="https://chrisoffner.github.io/studynotes/posts/2021/11/iterative-closest-point-icp-algorithm/">Iterative Closest Point (ICP) Algorithm</a>
      </h1>

      
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
    integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
    integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4"
    crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
    integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>
      

      

      

      

      <div class="post-content">
        <ul>
<li>ICP is used in Simultaneous Localisation and Mapping (SLAM) systems for LiDAR or RGBD data</li>
<li>The algorithm is comprised of two steps:
<ul>
<li><strong>Data association</strong>
Let \(A, B\) be our point clouds.
For each point \(a_i \in A\) we perform a nearest-neighbour search among points \(b_j \in B\) to find the point \(b_j\) with closest distance to \(a_i\).</li>
<li><strong>Transformation</strong>
Align point clouds on top of each other.
Compute centres of mass.
Compute rotation using Singular Value Decomposition (SVD).</li>
</ul>
</li>
</ul>
<p><strong>Variants of ICP</strong></p>
<ul>
<li><em>Point-to-plane</em> assumes that points are not independent points in space but have been sampled from a surface (plane?). Requires to leave SVD approach and use a general least-squares approach instead. Then use, for example, the Gauss-Newton method to minimise the error under this point-to-plane metric.</li>
<li><em>Projective ICP</em></li>
<li>robust kernels (?) to better deal with outliers</li>
</ul>
<h3 id="the-basic-alignment-problem">The basic alignment problem</h3>
<p>Given two input point sets \(X = {x_1, &hellip;, x_I}, Y={y_1,&hellip;,y_J}\) with correspondences \(C={(i,j)}\), we are looking for translation \(t\) and rotation \(R\) that minimise the sum of squared errors:</p>
<p>$$\sum_{(i,j)\in C} ||y_i - Rx_j - t||^2 \rightarrow \min$$</p>
<h3 id="simplified-correspondences">Simplified correspondences</h3>
<p>Reorder point clouds \(X, Y\) given the correspondences \(C\) using an index \(n\).</p>
<p>Point sets \({x_n}, {y_n}\)</p>
<p>Find the rigid body transform</p>
<p>$$\overline{x}_n = R x_n + t, \quad n\in{1,&hellip;, N}, N := |C|$$</p>
<p>that transforms points \({x_n}\) into \({\overline{x}_n}\) such that the point set \({\overline{x}_n}\) will be as close as possible to the point set \({y_n}\), i.e. minimising the sum of squared point-to-point distances.</p>
<h3 id="special-case-of-the-absolute-orientation-problem">Special case of the Absolute Orientation Problem</h3>
<p>In the absolute orientation problem, we look for the similarity transform</p>
<p>$$\overline{x}_n = \lambda R \bold{x}_n + \bold{t}$$</p>
<p>transforming 3D point sets, including a scaling factor \(\lambda\). Here, we only need the rigid body transform, meaning we assume \(\lambda = 1\).</p>
<h3 id="formal-problem-definition">Formal problem definition</h3>
<p>Given corresponding points \(x_n, y_n, n \in {1,&hellip;, N}\)</p>
<p>and optionally weights \(p_n\)</p>
<p>find the parameters \(R, \bold{t}\) of the rigid body transform with</p>
<p>$$\overline{x}_n = R\bold{x}_n + \bold{t},\quad n\in{1,&hellip;,N}$$</p>
<p>such that the squared error is minimised</p>
<p>$$\sum ||\bold{y}_n - \bold{\overline{x}}_n||^2p_n \rightarrow \min$$</p>
<h3 id="direct-optimal-solutions-exists">Direct optimal solutions exists</h3>
<p>Assuming perfect known data association, a direct and optimal solution exists.</p>
<p><strong>Direct</strong>: no initial guess and no iteration required</p>
<p><strong>Optimal</strong>: no better solution exists</p>
<p>Informally speaking it</p>
<ul>
<li>computes a <em>shift</em> involving the <em>centres of mass</em> of both point clouds</li>
<li>performs a <em>rotational</em> alignment using SVD</li>
</ul>
<h3 id="direct-computation-of-the-rotation-matrix-r">Direct computation of the rotation matrix \(R\)</h3>
<p>$$\bold{x}_0 = \frac{\sum \bold{x}_np_n}{\sum p_n} \qquad \bold{y}_0 = \frac{\sum \bold{y}_np_n}{\sum p_n}$$</p>
<p>Use the weighted means of each point set to calculate a so-called <strong>cross-covariance (or cross-correlation) matrix \(H\):</strong></p>
<p>$$H = \sum(\bold{y}_n - \bold{y}_0)(\bold{x}_n - \bold{x}_0)^T p_n$$</p>
<p>And then we decompose \(H\) into three matrices \(U, D,\) and \(V.\)</p>
<p>$$\mathrm{svd}(H) = UDV^T$$</p>
<p>The rotation matrix we&rsquo;re looking for is</p>
<p>$$R = VU^T$$</p>
<h3 id="direct-computation-of-the-translation-vector-boldt">Direct computation of the translation vector \(\bold{t}\)</h3>
<p>$$t = \bold{y}_0 - R\bold{x}_0$$</p>
<h3 id="svd-based-alignment">SVD-based alignment</h3>
<p>Compute mean-reduced coordinates</p>
<ul>
<li>\(\bold{a}_n = (\bold{y}_n - \bold{y}_0)\)</li>
<li>\(\bold{b}_n = (\bold{x}_n - \bold{x}_0)\)</li>
</ul>
<p>Compute cross-covariance matrix</p>
<ul>
<li>\(H = \sum \bold{a}_n \bold{b}_n^T p_n\)</li>
</ul>
<p>Compute SVD</p>
<ul>
<li>\(\mathrm{svd(H)} = UDV^T\)</li>
</ul>
<p>Rotation matrix is given by</p>
<ul>
<li>\(R = UV^T\) (which one is correct, this or the one above??)</li>
</ul>
<p>Translation vector is given by</p>
<ul>
<li>\(t = y_0 - Rx_0\)</li>
</ul>
<p>Translate and rotate points</p>
<ul>
<li>\(\overline{x}_n=R x_n + t\)</li>
</ul>
<h2 id="derivation">Derivation</h2>
<h3 id="use-local-coordinate-system">Use local coordinate system</h3>
<p>We want to use local coordinates defined by the point set \({y_n}\)</p>
<p>We set the origin as the weighted mean of \({y_n}\) computed by</p>
<p>$$y_0 = \frac{\sum y_np_n}{\sum p_n}$$</p>
<p>such that we minimise</p>
<p>$$\sum ||y_n - y_0 - Rx_n - t + y_0||^2 p_n \rightarrow \min$$</p>
<h3 id="rewrite-translation-vector">Rewrite translation vector</h3>
<p>Start with \(\overline{x}_n = Rx_n+t\) and use the shift of the origin \(\overline{x}_n - y_0 = Rx_n + t - y_0\) to rewrite the translation vector. Here we exploit the fact that for rotation matrices, \(R R^T = I\):</p>
<p>$$⁍$$</p>
<p>Introduce a <em><strong>new variable</strong></em> \(x_0 = R^T y_0-R^Tt:\)</p>
<p>$$\overline{x}_n-y_0 = R(x_n-x_0)$$</p>
<h3 id="minimisation">Minimisation</h3>
<p>Initially formulated problem:</p>
<p>$$\sum || y_n - \overline{x}_n||^2p_n \rightarrow \min$$</p>
<p>turns into</p>
<p>$$\sum || y_n - y_0 - R(x_n - x_0)||^2p_n \rightarrow \min$$</p>
<p>We need to find \(R^<em>, x_0^</em>\) such that</p>
<p>$$R^<em>, x_0^</em> = \argmin_{R, x_0}\sum || y_n - y_0 - R(x_n - x_0)||^2p_n$$</p>
<p>Computation:</p>
<p>$$\begin{align*}
\Phi(x_0, R) \coloneqq \sum &amp;\left[ (y_n -y_0) - R(x_n - x_0) \right]^T\&amp;\left[ (y_n -y_0) - R(x_n - x_0) \right]p_n\
= \sum &amp;(y_n-y_0)^T(y_n-y_0)p_n &amp;&amp; \text{(no \(R, x_0\))}\</p>
<ul>
<li>\sum &amp;(x_n-x_0)^T(x_n-x_0)p_n&amp;&amp; \text{(no \(R\))}\</li>
</ul>
<ul>
<li>2\sum &amp;(y_n-y_0)^TR(x_n-x_0)p_n
\end{align*}$$</li>
</ul>
<h3 id="minimise-with-regard-to-x_0">Minimise with regard to \(x_0\)</h3>
<p>$$\begin{align*}
\frac{\partial\Phi(x_0, R)}{\partial x_0} = &amp;-2\sum(x_n - x_0)p_n\
&amp;+2\sum R^T(y_n-y_0)p_n
\end{align*}$$</p>
<p>Setting the first derivative to zero simplifies this to:</p>
<p>$$\sum(x_n - x_0)p_n = R^T\sum (y_n-y_0)p_n$$</p>
<p>The right side of this equals zero because \(y_0\) is the weighted mean of \(y_n\).</p>
<p>$$\begin{align*}
0 = &amp;\sum(x_n-x_0)p_n\
= &amp;\sum x_np_n - x_0\sum p_n
\end{align*}$$</p>
<p>This leads to</p>
<p>$$x_0 = \frac{\sum x_np_n}{\sum p_n}$$</p>
<p>which means <strong>the optimal value for \(x_0\) is the weighted mean of the points</strong> \(x_n\).</p>
<h3 id="minimise-with-regard-to-r">Minimise with regard to \(R\)</h3>
<p>Only the third term of \(\Phi(x_0, R)\) depends on \(R.\) We therefore need to find the \(R\) that maximises</p>
<p>$$\sum (y_n-y_0)^TR(x_n-x_0)p_n$$</p>
<p>with the constraint \(R^TR = I\).</p>
<p>Compute mean-reduced coordinates</p>
<ul>
<li>\(\bold{b}_n = (\bold{y}_n - \bold{y}_0)\)</li>
<li>\(\bold{a}_n = (\bold{x}_n - \bold{x}_0)\)</li>
</ul>
<p>This leads to the compact form</p>
<p>$$\sum b_n^TRa_np_n$$</p>
<h3 id="rewrite-using-the-trace">Rewrite using the trace</h3>
<p>$$\begin{align*}
R^* = &amp;\argmax_R \sum b_n^TRa_np_n\
= &amp;\argmax_R \mathrm{tr}(RH)
\end{align*}$$</p>
<p>with the cross-covariance matrix \(H = \sum(a_nb_n^T)p_n\)</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Thus we need to find \(R\) that maximises \(\mathrm{tr}(RH)\)</p>
<h3 id="maximisation-using-svd">Maximisation using SVD</h3>
<p>$$\mathrm{svd}(H) = UDV^T$$</p>
<p>with  \(U^TU = I,\quad V^TV=I,\quad D=\mathrm{diag}(d_i)\).</p>
<h1 id="resources">Resources</h1>
<h3 id="icp-lectures">ICP lectures</h3>
<p><a href="https://www.youtube.com/watch?v=QWDM4cFdKrE">Iterative Closest Point (ICP) - 5 Minutes with Cyrill</a></p>
<p><a href="https://www.youtube.com/watch?v=dhzLQfDBx2Q">ICP &amp; Point Cloud Registration - Part 1: Known Data Association &amp; SVD (Cyrill Stachniss, 2021)</a></p>
<p><a href="https://www.youtube.com/watch?v=ktRqKxddjJk">ICP &amp; Point Cloud Registration - Part 2: Unknown Data Association (Cyrill Stachniss, 2021)</a></p>
<p><a href="https://www.youtube.com/watch?v=CJE59i8oxIE">ICP &amp; Point Cloud Registration - Part 3: Non-linear Least Squares (Cyrill Stachniss, 2021)</a></p>
<p><a href="https://www.youtube.com/watch?v=2hC9IG6MFD0">Point-to-Plane and Generalized ICP - 5 Minutes with Cyrill</a></p>
<h3 id="svd-lectures">SVD lectures</h3>
<p><a href="https://www.youtube.com/playlist?list=PLMrJAkhIeNNSVjnsviglFoY2nXildDCcv">Singular Value Decomposition</a></p>
<h3 id="papers">Papers</h3>
<p><a href="Iterative%20Closest%20Point%20(ICP)%20Algorithm%2020211195965c45b5b3af81743be4477f/On_the_ICP_Algorithm.pdf">On the ICP Algorithm.pdf</a></p>
<p><a href="Iterative%20Closest%20Point%20(ICP)%20Algorithm%2020211195965c45b5b3af81743be4477f/Worst-case_and_Smoothed_Analysis_of_the_ICP_Algorithm_with_an_Application_to_the_k-means_Method.pdf">Worst-case and Smoothed Analysis of the ICP Algorithm, with an Application to the k-means Method.pdf</a></p>
<p><a href="Iterative%20Closest%20Point%20(ICP)%20Algorithm%2020211195965c45b5b3af81743be4477f/Provably_Approximated_ICP.pdf">Provably Approximated ICP.pdf</a></p>
<p><a href="Iterative%20Closest%20Point%20(ICP)%20Algorithm%2020211195965c45b5b3af81743be4477f/Efficient_Variants_of_the_ICP_Algorithm.pdf">Efficient Variants of the ICP Algorithm.pdf</a></p>
<p><a href="Iterative%20Closest%20Point%20(ICP)%20Algorithm%2020211195965c45b5b3af81743be4477f/Geometrically_Stable_Sampling_for_the_ICP_Algorithm.pdf">Geometrically Stable Sampling for the ICP Algorithm.pdf</a></p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          10.11.2021 11:48
        

         
          
        
      </p>
    </div>

    
    <div class="pagination">
        <div class="pagination__title">
            <span class="pagination__title-h"></span>
            <hr />
        </div>

        <div class="pagination__buttons">
            
            <span class="button previous">
                <a href="https://chrisoffner.github.io/studynotes/posts/2021/11/first-post/">
                    <span class="button__icon">←</span>
                    <span class="button__text">First Post</span>
                </a>
            </span>
            

            
        </div>
    </div>


    

    

  </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2021</span>
            <span><a href="https://chrisoffner.github.io/studynotes/">Chris Offner</a></span>
            
            
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="https://chrisoffner.github.io/studynotes/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js" integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>



    </body>
</html>
